<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Macros de Suporte - Admin GitHub</title>
  <style>
    :root {
      --bg: #f3f3f3;
      --card: #ffffff;
      --text: #000000;
      --macro-bg: #fafafa;
      --macro-border: #ddd;
      --button: #007bff;
      --button-hover: #0056b3;
    }
    body.dark {
      --bg: #1a1a1a;
      --card: #222222;
      --text: #f1f1f1;
      --macro-bg: #2a2a2a;
      --macro-border: #444;
      --button: #3d8bff;
      --button-hover: #1c5cd1;
    }
    body {
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 20px;
      transition: 0.3s;
    }
    .categoria {
      background: var(--card);
      padding: 20px;
      margin-bottom: 25px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .macro {
      background: var(--macro-bg);
      padding: 15px;
      border: 1px solid var(--macro-border);
      border-radius: 8px;
      margin-bottom: 15px;
    }
    button { background: var(--button); border: none; color: white; padding: 10px 15px; border-radius: 6px; cursor: pointer; }
    button:hover { background: var(--button-hover); }
    #adminPanel { display:none; background:var(--card); padding:20px; border-radius:10px; margin-top:20px; }
    textarea { width:100%; height:120px; margin-bottom:10px; border-radius:8px; border:1px solid var(--macro-border); background:var(--macro-bg); color:var(--text); padding:10px; }
  </style>
</head>
<body>
  <h1>ðŸ“„ Macros de Suporte / Staff</h1>
  <button onclick="toggleDarkMode()">Alternar Modo Escuro</button>
  <button onclick="loginAdmin()">Painel Admin</button>

  <div id="conteudo"></div>

  <div id="adminPanel">
    <h2>Painel Admin</h2>
    <p>Edite abaixo e salve no GitHub automaticamente.</p>
    <textarea id="editor"></textarea>
    <button onclick="salvarGitHub()">Salvar no GitHub</button>
  </div>

<script>
const repoUser = "Koper-dev";
const repoName = "index.html";
const filePath = "macros.json";
let githubToken = "";
let fileSha = "";

async function carregarMacros() {
  const res = await fetch(`https://raw.githubusercontent.com/${repoUser}/${repoName}/main/${filePath}`);
  const data = await res.json();

  let html = "";
  for (const categoria of data.categorias) {
    html += `<div class='categoria'><h2>${categoria.nome}</h2>`;
    categoria.macros.forEach((m, i) => {
      html += `<div class='macro'><div class='macro-texto'>${m}</div><button onclick=\"copiar('${m}')\">Copiar</button></div>`;
    });
    html += `</div>`;
  }

  document.getElementById("conteudo").innerHTML = html;
}

function copiar(txt) { navigator.clipboard.writeText(txt); alert("Copiado!"); }
function toggleDarkMode() { document.body.classList.toggle("dark"); }

function loginAdmin() {
  githubToken = prompt("Token do GitHub (com permissÃ£o de commit):");
  if (!githubToken) return alert("Token invÃ¡lido.");

  fetch(`https://api.github.com/repos/${repoUser}/${repoName}/contents/${filePath}`)
    .then(r => r.json())
    .then(d => {
      fileSha = d.sha;
      return fetch(d.download_url);
    })
    .then(r => r.text())
    .then(txt => {
      editor.value = txt;
      adminPanel.style.display = "block";
    });
}

async function salvarGitHub() {
  const conteudoBase64 = btoa(unescape(encodeURIComponent(editor.value)));

  await fetch(`https://api.github.com/repos/${repoUser}/${repoName}/contents/${filePath}`, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${githubToken}`
    },
    body: JSON.stringify({
      message: "AtualizaÃ§Ã£o automÃ¡tica pelo painel admin",
      content: conteudoBase64,
      sha: fileSha
    })
  });

  alert("Salvo!");
  location.reload();
}

carregarMacros();
</script>
</body>
</html>
